<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Verification - School Management System</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN warning for development
        console.warn = function(message) {
            if (message.includes('tailwindcss.com should not be used in production')) {
                return; // Suppress this warning
            }
            console.log(message); // Log other warnings normally
        };
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full bg-white rounded-lg shadow-lg p-8">
            <div class="text-center">
                <!-- Loading/Verifying State -->
                <div id="verifyingState" class="block">
                    <div class="mb-6">
                        <i class="fas fa-spinner fa-spin text-4xl text-blue-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Verifying your account...</h2>
                    <p class="text-gray-600">Please wait while we verify your account.</p>
                </div>

                <!-- Success State -->
                <div id="successState" class="hidden">
                    <div class="mb-6">
                        <i class="fas fa-check-circle text-4xl text-green-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-green-600 mb-2">Account Verified!</h2>
                    <p class="text-gray-600 mb-4" id="successMessage">Account verified successfully!</p>
                    <p class="text-sm text-gray-500 mb-4">Redirecting to login page in <span id="countdown">3</span> seconds...</p>
                    <a href="/login" class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-200">
                        Go to Login
                    </a>
                </div>

                <!-- Error State -->
                <div id="errorState" class="hidden">
                    <div class="mb-6">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-red-600 mb-2">Verification Failed</h2>
                    <p class="text-gray-600 mb-4" id="errorMessage">Invalid or expired verification link.</p>
                    <p class="text-sm text-gray-500 mb-4">Redirecting to login page in <span id="errorCountdown">5</span> seconds...</p>
                    <a href="/login" class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition duration-200">
                        Go to Login
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const status = urlParams.get('status');
        const message = urlParams.get('message');

        // Elements
        const verifyingState = document.getElementById('verifyingState');
        const successState = document.getElementById('successState');
        const errorState = document.getElementById('errorState');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const countdown = document.getElementById('countdown');
        const errorCountdown = document.getElementById('errorCountdown');

        function showSuccess(message) {
            verifyingState.classList.add('hidden');
            successState.classList.remove('hidden');
            successMessage.textContent = message;
            
            // Start countdown
            let seconds = 3;
            const timer = setInterval(() => {
                countdown.textContent = seconds;
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(timer);
                    window.location.href = '/login';
                }
            }, 1000);
        }

        function showError(message) {
            verifyingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            errorMessage.textContent = message;
            
            // Start countdown for error (longer delay)
            let seconds = 5;
            const timer = setInterval(() => {
                errorCountdown.textContent = seconds;
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(timer);
                    window.location.href = '/login';
                }
            }, 1000);
        }

        // Handle verification result when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (status === 'success') {
                showSuccess(message || 'Account verified successfully!');
            } else if (status === 'error') {
                showError(message || 'Invalid or expired verification link.');
            } else {
                // No status parameter - this shouldn't happen with proper redirects
                showError('Invalid verification link!');
            }
        });
    </script>
</body>
</html>
