<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">My Children - Parent Portal</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .sidebar-transition {
            transition: all 0.3s ease;
        }
        .sidebar-mobile {
            transform: translateX(-100%);
        }
        .sidebar-mobile.open {
            transform: translateX(0);
        }
        @media (min-width: 768px) {
            .sidebar-mobile {
                transform: translateX(0);
            }
        }
        .child-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Mobile Overlay -->
    <div class="fixed inset-0 z-40 bg-black bg-opacity-50 hidden" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg sidebar-transition sidebar-mobile" id="sidebar">
        <!-- Logo -->
        <div class="flex items-center justify-between h-16 bg-primary-600 px-4">
            <div class="flex items-center space-x-2">
                <i class="fas fa-graduation-cap text-white text-2xl"></i>
                <span class="text-xl font-bold text-white">SchoolManager</span>
            </div>
            <!-- Mobile Close Button -->
            <button onclick="toggleSidebar()" class="md:hidden p-2 rounded-md text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-300">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>

        <!-- User Info -->
        <div class="p-4 border-b border-gray-200">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-user-friends text-primary-600"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate" id="parentName">Parent Name</p>
                    <p class="text-xs text-gray-500">Guardian</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="mt-5 px-2">
            <div class="space-y-1">
                <a href="/dashboard/parent" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-tachometer-alt text-gray-400 mr-3"></i>
                    Dashboard
                </a>
                <a href="/dashboard/parent/children" class="nav-item bg-primary-100 text-primary-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-user-graduate text-primary-500 mr-3"></i>
                    My Children
                </a>
                <a href="/dashboard/parent/progress" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-chart-line text-gray-400 mr-3"></i>
                    Progress
                </a>
                <a href="/dashboard/parent/attendance" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-calendar-check text-gray-400 mr-3"></i>
                    Attendance
                </a>
                <a href="/dashboard/parent/assignments" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-clipboard-list text-gray-400 mr-3"></i>
                    Assignments
                </a>
                <a href="/dashboard/parent/exams" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-calendar-alt text-gray-400 mr-3"></i>
                    Exams
                </a>
                <a href="/dashboard/parent/fees" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-money-bill-wave text-gray-400 mr-3"></i>
                    Fees
                </a>
                <a href="/dashboard/parent/messages" class="nav-item text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                    <i class="fas fa-comments text-gray-400 mr-3"></i>
                    Messages
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="pl-0 md:pl-64" id="mainContent">
        <!-- Top Navigation -->
        <div class="bg-white shadow-sm border-b border-gray-200">
            <div class="px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Mobile Menu Button & Page Title -->
                    <div class="flex items-center space-x-4">
                        <!-- Mobile Menu Button -->
                        <button onclick="toggleSidebar()" class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        
                        <!-- Page Title -->
                        <h1 class="text-2xl font-bold text-gray-900">
                            <i class="fas fa-user-graduate text-primary-600 mr-2"></i>
                            My Children
                        </h1>
                    </div>

                    <!-- Right Side Actions -->
                    <div class="flex items-center space-x-4">
                        <!-- Notifications -->
                        <button class="p-2 text-gray-400 hover:text-gray-500 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-400 ring-2 ring-white"></span>
                        </button>
                        
                        <!-- User Menu -->
                        <div class="relative" id="userMenuContainer">
                            <button class="flex items-center space-x-2 text-gray-700 hover:text-gray-900" onclick="toggleUserDropdown()">
                                <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-friends text-primary-600 text-sm"></i>
                                </div>
                                <span class="hidden md:block text-sm font-medium" id="headerParentName">Parent</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
                                <div class="py-1">
                                    <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <i class="fas fa-user mr-2"></i> Profile
                                    </a>
                                    <a href="/settings" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <i class="fas fa-cog mr-2"></i> Settings
                                    </a>
                                    <hr class="my-1">
                                    <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-red-700 hover:bg-red-50">
                                        <i class="fas fa-sign-out-alt mr-2"></i> Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Page Header -->
            <div class="mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Children Overview</h2>
                <p class="text-sm text-gray-600 mt-1">View and manage your children's academic information</p>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- Total Children -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Total Children</p>
                            <p class="text-2xl font-bold text-gray-900" id="totalChildren">0</p>
                        </div>
                    </div>
                </div>

                <!-- Average Attendance -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Avg Attendance</p>
                            <p class="text-2xl font-bold text-gray-900" id="avgAttendance">0%</p>
                        </div>
                    </div>
                </div>

                <!-- Pending Fees -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-rupee-sign text-yellow-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Pending Fees</p>
                            <p class="text-2xl font-bold text-gray-900" id="totalPendingFees">₹0</p>
                        </div>
                    </div>
                </div>

                <!-- Alerts -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Urgent Alerts</p>
                            <p class="text-2xl font-bold text-gray-900" id="urgentAlerts">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
                    <div class="flex-1 max-w-lg">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <input type="text" id="searchInput" 
                                   class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm" 
                                   placeholder="Search children...">
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <select id="statusFilter" class="block w-40 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            <option value="">All Status</option>
                            <option value="ACTIVE">Active</option>
                            <option value="INACTIVE">Inactive</option>
                        </select>
                        
                        <select id="performanceFilter" class="block w-40 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                            <option value="">All Performance</option>
                            <option value="EXCELLENT">Excellent</option>
                            <option value="GOOD">Good</option>
                            <option value="AVERAGE">Average</option>
                            <option value="POOR">Poor</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Children Cards Grid -->
            <div id="childrenContainer">
                <!-- Loading State -->
                <div id="childrenLoadingState" class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-primary-500 mb-4"></i>
                    <p class="text-gray-600">Loading children...</p>
                </div>

                <!-- Empty State -->
                <div id="childrenEmptyState" class="hidden text-center py-12">
                    <i class="fas fa-user-graduate text-6xl text-gray-300 mb-4"></i>
                    <p class="text-gray-600 text-lg">No children found</p>
                    <p class="text-gray-500 text-sm mt-2">Contact school administration for assistance</p>
                </div>

                <!-- Children Grid -->
                <div id="childrenGrid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Child cards will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('👨‍👩‍👧‍👦 My Children page loaded');

        let allChildren = [];
        let filteredChildren = [];

        // Toggle sidebar for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }

        // Toggle user dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }

        // Close dropdown when clicking outside
        window.addEventListener('click', function(e) {
            const dropdown = document.getElementById('userDropdown');
            const userMenu = document.getElementById('userMenuContainer');
            
            if (dropdown && userMenu && !userMenu.contains(e.target)) {
                dropdown.classList.add('hidden');
            }
        });

        // Initialize page
        async function initializePage() {
            try {
                loadUserInfo();
                await loadChildren();
                setupEventListeners();
            } catch (error) {
                console.error('❌ Error initializing page:', error);
                showErrorState('Failed to initialize page');
            }
        }

        // Load children from API
        async function loadChildren() {
            try {
                showLoadingState();
                
                const token = localStorage.getItem('jwtToken');
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                const parentId = user.workerId || user.id;
                
                console.log('👨‍👩‍👧‍👦 Loading children for parent ID:', parentId);
                
                const response = await fetch(`/api/v1/parents/${parentId}/children`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const apiData = await response.json();
                console.log('📦 Children API Response:', apiData);
                
                // Handle different response formats
                let childrenData = [];
                if (apiData.data) {
                    childrenData = Array.isArray(apiData.data) ? apiData.data : 
                                  (apiData.data.content ? apiData.data.content : []);
                } else if (Array.isArray(apiData)) {
                    childrenData = apiData;
                }
                
                allChildren = childrenData;
                filteredChildren = [...allChildren];
                
                updateStatistics();
                displayChildren();
                
            } catch (error) {
                console.error('❌ Error loading children:', error);
                showErrorState('Error loading children');
            }
        }

        // Display children cards
        function displayChildren() {
            const container = document.getElementById('childrenGrid');
            const loadingState = document.getElementById('childrenLoadingState');
            const emptyState = document.getElementById('childrenEmptyState');
            
            if (!container) return;
            
            // Hide loading state
            if (loadingState) loadingState.classList.add('hidden');
            
            if (filteredChildren.length === 0) {
                container.classList.add('hidden');
                if (emptyState) emptyState.classList.remove('hidden');
                return;
            }
            
            // Show children grid
            container.classList.remove('hidden');
            if (emptyState) emptyState.classList.add('hidden');
            
            container.innerHTML = filteredChildren.map(child => {
                const performanceColor = getPerformanceColor(child.performanceIndicator);
                const attendanceColor = child.attendancePercentage >= 75 ? 'text-green-600' : 'text-red-600';
                const needsAttentionBadge = child.needsAttention ? 
                    '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 ml-2"><i class="fas fa-exclamation-triangle mr-1"></i>Alert</span>' : '';
                
                return `
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden card-hover cursor-pointer" onclick="viewChildDetails(${child.id})">
                        <!-- Child Header with Gradient -->
                        <div class="child-card p-6 text-white">
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                                    ${child.profileImageUrl ? 
                                        `<img src="${child.profileImageUrl}" alt="${child.name}" class="w-full h-full rounded-full object-cover">` :
                                        `<i class="fas fa-user-graduate text-primary-600 text-2xl"></i>`
                                    }
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold">${child.name}</h3>
                                    <p class="text-sm opacity-90">${child.className || 'N/A'} ${child.section ? '- ' + child.section : ''}</p>
                                    <p class="text-xs opacity-75">Roll No: ${child.rollNumber || 'N/A'}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Child Stats -->
                        <div class="p-6">
                            <!-- Performance Badge -->
                            <div class="flex items-center justify-between mb-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${performanceColor.bg} ${performanceColor.text}">
                                    ${child.performanceIndicator || 'AVERAGE'}
                                </span>
                                ${needsAttentionBadge}
                            </div>

                            <!-- Stats Grid -->
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <p class="text-xs text-gray-500 mb-1">Attendance</p>
                                    <p class="text-xl font-bold ${attendanceColor}">
                                        ${child.attendancePercentage ? child.attendancePercentage.toFixed(1) : '0'}%
                                    </p>
                                </div>
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <p class="text-xs text-gray-500 mb-1">Overall Grade</p>
                                    <p class="text-xl font-bold text-blue-600">${child.overallGrade || 'N/A'}</p>
                                </div>
                            </div>

                            <!-- Quick Info -->
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">
                                        <i class="fas fa-clipboard-list text-gray-400 mr-2"></i>
                                        Pending Assignments
                                    </span>
                                    <span class="font-semibold text-gray-900">${child.pendingAssignments || 0}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">
                                        <i class="fas fa-calendar-alt text-gray-400 mr-2"></i>
                                        Upcoming Exams
                                    </span>
                                    <span class="font-semibold text-gray-900">${child.upcomingExams || 0}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">
                                        <i class="fas fa-rupee-sign text-gray-400 mr-2"></i>
                                        Pending Fees
                                    </span>
                                    <span class="font-semibold ${child.pendingFees > 0 ? 'text-red-600' : 'text-green-600'}">
                                        ₹${child.pendingFees ? child.pendingFees.toLocaleString() : '0'}
                                    </span>
                                </div>
                            </div>

                            <!-- Last Activity -->
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <p class="text-xs text-gray-500">Last Attendance:</p>
                                <p class="text-sm font-medium text-gray-700 mt-1">
                                    ${child.lastAttendanceStatus || 'No Record'} 
                                    ${child.lastAttendanceDate ? '· ' + child.lastAttendanceDate : ''}
                                </p>
                            </div>

                            <!-- View Details Button -->
                            <button onclick="viewChildDetails(${child.id}); event.stopPropagation();" 
                                    class="mt-4 w-full bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors">
                                <i class="fas fa-eye mr-2"></i>
                                View Full Details
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            console.log(`✅ Displayed ${filteredChildren.length} children`);
        }

        // Update statistics
        function updateStatistics() {
            const totalChildrenEl = document.getElementById('totalChildren');
            const avgAttendanceEl = document.getElementById('avgAttendance');
            const totalPendingFeesEl = document.getElementById('totalPendingFees');
            const urgentAlertsEl = document.getElementById('urgentAlerts');
            
            if (totalChildrenEl) totalChildrenEl.textContent = allChildren.length;
            
            if (avgAttendanceEl) {
                const avgAttendance = allChildren.reduce((sum, child) => 
                    sum + (child.attendancePercentage || 0), 0) / (allChildren.length || 1);
                avgAttendanceEl.textContent = `${avgAttendance.toFixed(1)}%`;
            }
            
            if (totalPendingFeesEl) {
                const totalPending = allChildren.reduce((sum, child) => 
                    sum + (child.pendingFees || 0), 0);
                totalPendingFeesEl.textContent = `₹${totalPending.toLocaleString()}`;
            }
            
            if (urgentAlertsEl) {
                const alerts = allChildren.filter(child => child.needsAttention).length;
                urgentAlertsEl.textContent = alerts;
            }
        }

        // Filter children
        function filterChildren() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const performanceFilter = document.getElementById('performanceFilter').value;

            filteredChildren = allChildren.filter(child => {
                const matchesSearch = child.name.toLowerCase().includes(searchTerm) ||
                                    (child.admissionNumber && child.admissionNumber.toLowerCase().includes(searchTerm)) ||
                                    (child.className && child.className.toLowerCase().includes(searchTerm));
                
                const matchesStatus = !statusFilter || child.status === statusFilter;
                const matchesPerformance = !performanceFilter || child.performanceIndicator === performanceFilter;

                return matchesSearch && matchesStatus && matchesPerformance;
            });

            displayChildren();
        }

        // Setup event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            const statusFilter = document.getElementById('statusFilter');
            const performanceFilter = document.getElementById('performanceFilter');

            if (searchInput) searchInput.addEventListener('input', filterChildren);
            if (statusFilter) statusFilter.addEventListener('change', filterChildren);
            if (performanceFilter) performanceFilter.addEventListener('change', filterChildren);
        }

        // View child details
        function viewChildDetails(childId) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const parentId = user.workerId || user.id;
            
            // Navigate to child overview (will create this page later)
            alert(`Navigating to detailed view for child ID: ${childId}\n\nThis will show:\n- Complete attendance history\n- All grades and academic performance\n- Fee details and payment history\n- Assignments and exams\n- Teacher comments and notifications`);
            
            // TODO: Navigate to dedicated child overview page
            // window.location.href = `/dashboard/parent/child/${childId}/overview`;
        }

        // Get performance color
        function getPerformanceColor(performance) {
            switch(performance) {
                case 'EXCELLENT':
                    return { bg: 'bg-green-100', text: 'text-green-800' };
                case 'GOOD':
                    return { bg: 'bg-blue-100', text: 'text-blue-800' };
                case 'AVERAGE':
                    return { bg: 'bg-yellow-100', text: 'text-yellow-800' };
                case 'POOR':
                    return { bg: 'bg-red-100', text: 'text-red-800' };
                default:
                    return { bg: 'bg-gray-100', text: 'text-gray-800' };
            }
        }

        // Show loading state
        function showLoadingState() {
            const loadingEl = document.getElementById('childrenLoadingState');
            const emptyEl = document.getElementById('childrenEmptyState');
            const gridEl = document.getElementById('childrenGrid');
            
            if (loadingEl) loadingEl.classList.remove('hidden');
            if (emptyEl) emptyEl.classList.add('hidden');
            if (gridEl) gridEl.classList.add('hidden');
        }

        // Show error state
        function showErrorState(message) {
            const loadingEl = document.getElementById('childrenLoadingState');
            const emptyEl = document.getElementById('childrenEmptyState');
            const gridEl = document.getElementById('childrenGrid');
            
            if (loadingEl) loadingEl.classList.add('hidden');
            if (gridEl) gridEl.classList.add('hidden');
            
            if (emptyEl) {
                emptyEl.classList.remove('hidden');
                emptyEl.querySelector('p').textContent = message;
            }
        }

        // Load user info
        function loadUserInfo() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            const parentNameEl = document.getElementById('parentName');
            const headerParentNameEl = document.getElementById('headerParentName');
            
            if (user.name) {
                if (parentNameEl) parentNameEl.textContent = user.name;
                if (headerParentNameEl) headerParentNameEl.textContent = user.name;
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('jwtToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('user');
            window.location.href = '/login';
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>

